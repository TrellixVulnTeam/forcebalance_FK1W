<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ForceBalance: Installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ForceBalanceLogo_sm.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ForceBalance
   &#160;<span id="projectnumber">1.7.4</span>
   </div>
   <div id="projectbrief">Automated optimization of force fields and empirical potentials</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Installation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This section covers how to install ForceBalance.</p>
<p>Currently only Linux is supported, though installation on other Unix-based systems (e.g. Mac OS) should also be straightforward.</p>
<p>Importantly, note that <em>ForceBalance does not contain a simulation engine</em>. Instead it interfaces with simulation software like GROMACS, TINKER, AMBER or OpenMM; reference data is obtained from experimental measurements (consult the literature) or from quantum chemistry software (for example, NWChem or Q-Chem).</p>
<p>Several interfaces to existing software packages are provided. However, if you use ForceBalance for a research project, you should be prepared to write some simple Python code to interface with a software package of your choice. If you choose to do so, please contact me as I would be happy to include your contribution in the main distribution.</p>
<h1><a class="anchor" id="installing_forcebalance"></a>
Installing ForceBalance using conda package manager</h1>
<p>As of version 1.7.4, ForceBalance is available as a package on the conda-forge channel. To install the package, make sure you are using an Anaconda/Miniconda Python distribution for Python versions 2.7, 3.5, 3.6, or 3.7, then run:</p>
<pre class="fragment">python setup.py install </pre><p>This will install ForceBalance and all of the required dependencies. It will not install optional dependencies such as OpenMM, Gromacs, AMBER, Tinker, CCTools/Work Queue, or the Open Force Field toolkit.</p>
<h1><a class="anchor" id="installing_forcebalance"></a>
Installing ForceBalance using conda package manager</h1>
<p>ForceBalance is packaged as a Python module. Here are the installation instructions.</p>
<p>A quick preface: Installing software can be a real pain. I tried to make ForceBalance easy to install by providing clear instructions and minimizing the number of dependencies; however, complications and challenges during installation happen all the time. If you are running into installation problems or having trouble resolving a dependency, please contact me.</p>
<h2><a class="anchor" id="installing_forcebalance_prereq"></a>
Prerequisites</h2>
<p>ForceBalance requires the following software packages:</p>
<ul>
<li><a href="http://www.python.org/">Python</a> version 2.7 </li>
<li><a href="http://numpy.scipy.org/">NumPy</a> version 1.5 </li>
<li><a href="http://www.scipy.org/">SciPy</a> version 0.9</li>
</ul>
<p>The following packages are required for certain functionality:</p>
<ul>
<li><a href="http://lxml.de/">lxml</a> version 2.3.4 - Python interface to libxml2 for parsing OpenMM force field files </li>
<li><a href="http://nd.edu/~ccl/software/">cctools</a> version 3.4.1 - Cooperative Computing Tools from Notre Dame for distributed computing </li>
<li><a href="https://matplotlib.org">matplotlib</a> version 2.0.2 - Python plotting library which produces publication quality figures</li>
</ul>
<p>The following packages are used for documentation:</p>
<ul>
<li><a href="http://www.stack.nl/~dimitri/doxygen/">Doxygen</a> version 1.7.6.1 </li>
<li><a href="http://code.foosel.org/doxypy">Doxypy</a> plugin for Doxygen </li>
<li>LaTeX software such as <a href="http://www.tug.org/texlive/">TeXLive</a> </li>
<li>The dot program from <a href="http://www.graphviz.org/">graphviz</a> software package</li>
</ul>
<h2><a class="anchor" id="installing_forcebalance_install"></a>
Installing</h2>
<p>To install the package, first extract the tarball that you downloaded from the webpage using the command:</p>
<pre class="fragment">tar xvzf ForceBalance-[version].tar.gz </pre><p>Alternatively, download the newest Subversion revision from the SimTK website:</p>
<pre class="fragment">svn checkout https://simtk.org/svn/forcebalance </pre><p>Upon extracting the distribution you will see this directory structure:</p>
<pre class="fragment"> &lt;root&gt;
   +- bin
   |   |- &lt;Executable scripts&gt;
   +- src
   |   |- &lt;ForceBalance source files&gt;
   +- ext
   |   |- &lt;Extensions; self-contained software packages that are used by ForceBalance&gt;
   +- studies
   |   +- &lt;ForceBalance example jobs&gt;
   +- doc
   |   +- callgraph
   |   |   |- &lt;Stuff for making a call graph&gt;
   |   +- Images
   |   |   |- &lt;Images for the website and PDF manual&gt;
   |   |- make-all-documentation.sh (Create the documentation)
   |   |- &lt;Below are documentation chapters in Doxygen format&gt;
   |   |- introduction.txt
   |   |- installation.txt
   |   |- usage.txt
   |   |- tutorial.txt
   |   |- glossary.txt
   |   |- &lt;The above files are concatenated into mainpage.py&gt;
   |   |- make-all-documentation.sh (Command for making all documentation)
   |   |- make-option-index.py (Create the option index documentation chapter)
   |   |- header.tex (Customize the LaTex documentation)
   |   |- add-tabs.py (Adds more navigation tabs to the webpage)
   |   |- DoxygenLayout.xml (Removes a navigation tab from the webpage)
   |   |- doxygen.cfg (Main configuration file for Doxygen)
   |   |- ForceBalance-Manual.pdf (PDF manual, but the one on the SimTK website is probably newer)
   |- PKG-INFO (Auto-generated package information)
   |- README.txt (Points to the SimTK website)
   |- setup.py (Python script for installation) </pre><p>To install the code into your default Python location, run this (you might need to be root):</p>
<pre class="fragment">python setup.py install </pre><p>You might not have root permissions, or you may want to install the package somewhere other than the default location. You can install to a custom location (for example, to /home/leeping/local) by running:</p>
<pre class="fragment">python setup.py install --prefix=/home/leeping/local </pre><p>Assuming your Python version is 2.7, the executable scripts will be placed into <code>/home/leeping/local/bin</code> and the module will be placed into <code>/home/leeping/local/lib/python2.7/site-packages/forcebalance</code>.</p>
<p>Note that Python does not always recognize installed modules in custom locations. Any one of the three below options will work for adding custom locations to the Python search path for installed modules:</p>
<pre class="fragment">ln -s /home/leeping/local /home/leeping/.local </pre> <pre class="fragment">export PYTHONUSERBASE=/home/leeping/local </pre> <pre class="fragment">export PYTHONPATH=$PYTHONPATH:/home/leeping/local/lib/python2.7 </pre><p>As with the installation of any software, there are potential issues with dependencies (for example, scipy and lxml.) One way to resolve dependencies is to use the Enthought Python Distribution (EPD), which contains all of the required packages and is free for academic users. Install EPD from the <a href="http://www.enthought.com/products/epd.php">Enthought website</a>. Configure your environment by running both of the commands below (assuming Enthought was installed to <code> /home/leeping/opt/epd-7.3.2 </code>, with the python executable in the <code>bin</code> subdirectory):</p>
<pre class="fragment"> export PATH=/home/leeping/opt/epd-7.3.2/bin:$PATH
 export PYTHONUSERBASE=/home/leeping/opt/epd-7.3.2 </pre><p>An alternative option is to use Anaconda2, that can be downloaded <a href="https://www.continuum.io/downloads">the Continuum website</a>. It is also free for academic users.</p>
<pre class="fragment"> export PATH=/home/leeping/opt/anaconda2/bin:$PATH </pre><p>Once you have done this, the Numpy, Scipy, Matplotlib and lxml dependency issues should be resolved and ForceBalance will run without any problems.</p>
<p>Here are a list of installation notes (not required if you install ForceBalance into the Enthought Python Distribution). These notes assume that Python and other packages are installed into $HOME/local.</p>
<ul>
<li>The installation of Numpy, Scipy and lxml may be facilitated by installing the <code>pip</code> package - simply run a command like <code>pip install numpy</code>. </li>
<li>Scipy requires a BLAS (Basic Linear Algebra Subroutines) library to be installed. On certain Linux distributions such as Ubuntu, the BLAS libraries and headers can be found on the repository (run <code>sudo apt-get install libblas-dev</code>). Also, BLAS is provided by libraries such as ATLAS (Automatically Tuned Linear Algebra Software) or the Intel MKL (Math Kernel Library) for Intel processors. To compile Scipy with Intel's MKL, follow the guide on <a href="http://software.intel.com/en-us/articles/numpy-scipy-with-mkl">Intel's website</a>. To use ATLAS, install the package from the <a href="http://math-atlas.sourceforge.net">ATLAS website </a> and set the ATLAS environment variable (for example, <code>export ATLAS=$HOME/local/lib/libatlas.so</code>) before installing Scipy. </li>
<li><code>lxml</code> is a Python interface to the libxml2 XML parser. After much ado, I decided to use <code>lxml</code> instead of the <code>xml</code> module in Python's standard library for several reasons (<code>xml</code> contains only limited support for XPath, scrambles the ordering of attributes in an element, etc.) The downside is that it can be harder to install. Installation instructions can be found on the <a href="http://lxml.de/installation.html">lxml website</a> but summarized here. The packages <code>libxml2</code> and <code>libxslt</code> need to be installed first, and in that order. On Ubuntu, run <code>sudo apt-get install libxml2-dev libxslt1-dev</code>. To compile from source, run <code>./configure &ndash;prefix=$HOME/local &ndash;with-python=$HOME/local</code>. Then run <code>make</code> followed by <code>make install</code>. Python itself needs to be compiled with <code>&ndash;enable-shared</code> for this to work. Finally, download and unzip <code>lxml</code>, then run <code> python setup.py install &ndash;prefix=$HOME/local </code>.</li>
</ul>
<h1><a class="anchor" id="create_doc"></a>
Create documentation</h1>
<p>This documentation is created by Doxygen with the Doxypy plugin. To create new documentation or expand on what's here, follow the examples in the source code or visit the Doxygen home page.</p>
<p>To create this documentation from the source files, go to the <code>doc</code> directory in the distribution and run <code> doxygen doxygen.cfg </code> to generate the HTML documentation and LaTeX source files. Run the <code>add-tabs.py</code> script to generate the extra navigation tabs for the HTML documentation. Then go to the <code>latex</code> directory and type in <code>make</code> to build the PDF manual (You will need a LaTeX distribution for this.) All of this is automated by running <code>make-all-documentation.sh</code>.</p>
<h1><a class="anchor" id="install_gmxx2"></a>
Installing GROMACS-X2</h1>
<p><em> GROMACS-X2 is not required for ForceBalance and is currently deprecated. Installation is not recommended. This section is retained for your information and in case I choose to revive the software. </em></p>
<p>I have provided a specialized version of GROMACS (dubbed version 4.0.7-X2) on the <a href="https://simtk.org/home/forcebalance/">SimTK website</a> which interfaces with ForceBalance through the abinitio_gmxx2 module. Although interfacing with unmodified simulation software is straightforward, GROMACS-X2 is optimized for force field optimization and makes things much faster.</p>
<p>GROMACS-X2 contains major modifications from GROMACS 4.0.7. Most importantly, it enables computation of the objective function and its analytic derivatives for rapid energy and force matching. There is also an implementation of the QTPIE fluctuating-charge polarizable force field, and the beginnings of a GROMACS/Q-Chem interface (carefully implemented but not extensively tested). Most of the changes were added in several new source files (less than ten): <code>qtpie.c</code>, <code>fortune.c</code>, <code>fortune_utils.c</code>, <code>fortune_vsite.c</code>, <code>fortune_nb_utils.c</code>, <code>zmatrix.c</code> and their corresponding header files, and <code>fortunerec.h</code> for the force matching data structure. The name 'fortune' derives from back when this code was called ForTune.</p>
<p>The force matching functions are turned on by calling <code>mdrun</code> with the command line argument <code>'-fortune'</code> ; without this option, there should be no impact on the performance of normal MD simulations.</p>
<p>ForceBalance interfaces with GROMACS-X2 through the functions in <code>abinitio_gmxx2.py</code> ; the objective function and derivatives are computed and printed to output files. The interface is defined in <code>fortune.c</code> on the GROMACS side. ForceBalance needs to know where the GROMACS-X2 executables are located, and this is specified using the <code>gmxpath</code> option in the input file.</p>
<h2><a class="anchor" id="install_gmxx2_prerequisites"></a>
Prerequisites for GROMACS-X2</h2>
<p>GROMACS-X2 needs the base GROMACS requirements and several other libraries.</p>
<ul>
<li>FFTW version 3.3 </li>
<li>GLib version 2.0 </li>
<li>Intel MKL library</li>
</ul>
<p>GLib is the utility library provided by the GNOME foundation (the folks who make the GNOME desktop manager and GTK+ libraries). GROMACS-X2 requires GLib for its hash table (dictionary).</p>
<p>GLib and FFTW can be compiled from source, but it is much easier if you're using a Linux distribution with a package manager. If you're running Ubuntu or Debian, run <code>sudo apt-get install libglib2.0-dev libfftw3-dev</code>; if you're using CentOS or some other distro with the yum package manager, run <code>sudo yum install glib2-devel.x86_64 fftw3-devel.x86_64</code> (or replace <code>x86_64</code> with <code>i386</code> if you're not on a 64-bit system.</p>
<p>GROMACS-X2 requires the Intel Math Kernel Library (MKL) for linear algebra. In principle this requirement can be lifted if I rewrite the source code, but it's a lot of trouble, plus MKL is faster than other implementations of BLAS and LAPACK.</p>
<p>The Intel MKL can be obtained from the Intel website, free of charge for noncommercial use. Currently GROMACS-X2 is built with MKL version 10.2, which ships with compiler version 11.1/072 ; this is not the newest version, but it can still be obtained from the Intel website after you register for a free account.</p>
<p>After installing these packages, extract the tarball that you downloaded from the website using the command:</p>
<pre class="fragment">tar xvjf gromacs-[version]-x2.tar.bz2 </pre><p>The directory structure is identical to GROMACS 4.0.7, but I added some shell scripts. <code>Build.sh</code> will run the configure script using some special options, compile the objects, create the executables and install them; you will probably need to modify it slightly for your environment. The comments in the script will help further with installation.</p>
<p>Don't forget to specify the install location of the GROMACS-X2 executables in the ForceBalance input file! </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jul 9 2020 11:51:07 for ForceBalance by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
